🔎 checking possible migrations..

🔎 found a 'new-frameworks' migration:
╭ Automigration detected ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                                      │
│   We've detected your project is not fully setup with Storybook's 7 new framework format.                                                                            │
│                                                                                                                                                                      │
│   Storybook 7 introduced the concept of frameworks, which abstracts configuration for renderers (e.g. React, Vue), builders (e.g. Webpack, Vite) and defaults to     │
│   make integrations easier.                                                                                                                                          │
│                                                                                                                                                                      │
│   Your project should be updated to use Storybook's framework: @storybook/react-webpack5. We can attempt to do this for you automatically.                           │
│                                                                                                                                                                      │
│   Here are the steps this migration will do to migrate your project:                                                                                                 │
│   - Remove the following dependencies:                                                                                                                               │
│   - * @storybook/builder-webpack5                                                                                                                                    │
│   - * @storybook/manager-webpack5                                                                                                                                    │
│   - Add the following dependencies:                                                                                                                                  │
│   - * @storybook/react-webpack5                                                                                                                                      │
│   - Update or specify the framework field in null with the value of "@storybook/react-webpack5".                                                                     │
│   - Remove the core.builder field in null.                                                                                                                           │
│                                                                                                                                                                      │
│                                                                                                                                                                      │
│   To learn more about the new framework format, see: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#new-framework-api                               │
│                                                                                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'new-frameworks' migration on your project? › (Y/n)✔ Do you want to run the 'new-frameworks' migration on your project? … yes
✅ Removing dependencies: @storybook/builder-webpack5, @storybook/manager-webpack5
✅ Installing new dependencies: @storybook/react-webpack5
❌ The migration failed to update your null on your behalf because of the following error:
        TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string or an instance of Buffer or URL. Received null

⚠️ Storybook automigrations are based on AST parsing and it's possible that your null file contains a non-standard format (e.g. your export is not an object) or that there was an error when parsing dynamic values (e.g. "require" calls, or usage of environment variables). When your main config is non-standard, automigrations are unfortunately not possible. Please follow the instructions given previously and follow the documentation to make the updates manually.
✅ ran new-frameworks migration

🔎 found a 'eslintPlugin' migration:
╭ Automigration detected ──────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                      │
│   We've detected you are not using our eslint-plugin.                                                                                │
│                                                                                                                                      │
│   In order to have the best experience with Storybook and follow best practices, we advise you to install eslint-plugin-storybook.   │
│                                                                                                                                      │
│   More info: https://github.com/storybookjs/eslint-plugin-storybook#readme                                                           │
│                                                                                                                                      │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'eslintPlugin' migration on your project? › (Y/n)✔ Do you want to run the 'eslintPlugin' migration on your project? … yes
✅ Adding dependencies: eslint-plugin-storybook
    Configuring Storybook ESLint plugin at .eslintrc.js
✅ ran eslintPlugin migration

🔎 found a 'storybook-binary' migration:
╭ Automigration detected ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                           │
│   We've detected you are using Storybook 7.3.1 without Storybook's storybook binary. Starting in Storybook 7.0, it has to be installed.   │
│                                                                                                                                           │
│                                                                                                                                           │
│   More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed            │
│                                                                                                                                           │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'storybook-binary' migration on your project? › (Y/n)✔ Do you want to run the 'storybook-binary' migration on your project? … yes

✅ Adding 'storybook' as dev dependency

✅ ran storybook-binary migration

🔎 found a 'sb-scripts' migration:
╭ Automigration detected ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                               │
│   We've detected you are using Storybook 7.3.1 with scripts from previous versions of Storybook.                                              │
│   Starting in Storybook 7, the start-storybook and build-storybook binaries have changed to storybook dev and storybook build respectively.   │
│   In order to work with Storybook 7.3.1, your storybook scripts have to be adjusted to use the binary. We can adjust them for you:            │
│                                                                                                                                               │
│   storybook                                                                                                                                   │
│   from:                                                                                                                                       │
│   start-storybook  -c ./storybook -p 6006 --ci                                                                                                │
│   to:                                                                                                                                         │
│   storybook dev  -c ./storybook -p 6006 --ci                                                                                                  │
│                                                                                                                                               │
│   storybook:build                                                                                                                             │
│   from:                                                                                                                                       │
│   BABEL_ENV=development build-storybook  -c ./storybook -o ./storybook/dist                                                                   │
│   to:                                                                                                                                         │
│   BABEL_ENV=development storybook build  -c ./storybook -o ./storybook/dist                                                                   │
│                                                                                                                                               │
│   In case this migration did not cover all of your scripts, or you'd like more info:                                                          │
│   https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#start-storybook--build-storybook-binaries-removed                           │
│                                                                                                                                               │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'sb-scripts' migration on your project? › (Y/n)✔ Do you want to run the 'sb-scripts' migration on your project? … yes
✅ Updating scripts in package.json


✅ ran sb-scripts migration

🔎 found a 'incompatible-addons' migration:
╭ Manual migration detected ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                               │
│   Attention: We've detected that you're using the following addons in versions which are known to be incompatible with Storybook 7:                           │
│                                                                                                                                                               │
│   - @storybook/addon-postcss@2.0.0                                                                                                                            │
│                                                                                                                                                               │
│   Please be aware they might not work in Storybook 7. Reach out to their maintainers for updates and check the following Github issue for more information:   │
│   https://github.com/storybookjs/storybook/issues/20529                                                                                                       │
│                                                                                                                                                               │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

? Select continue once you have made the required changes, or quit to exit the migration process › quit / continue✔ Select continue once you have made the required changes, or quit to exit the migration process … quit / continue

🔎 found a 'removedglobalclientapis' migration:
╭ Manual migration detected ─────────────────────────────────────────────────────────────────────╮
│                                                                                                │
│   Attention: We could not automatically make this change. You'll need to do it manually.       │
│                                                                                                │
│   The following APIs (used in ".storybook/preview.js") have been removed from Storybook:       │
│                                                                                                │
│   - addDecorator                                                                               │
│                                                                                                │
│   Please see the migration guide for more information:                                         │
│   https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#removed-global-client-apis   │
│                                                                                                │
╰────────────────────────────────────────────────────────────────────────────────────────────────╯

? Select continue once you have made the required changes, or quit to exit the migration process › quit / continue✔ Select continue once you have made the required changes, or quit to exit the migration process … quit / continue

🔎 found a 'autodocsTrue' migration:
╭ Automigration detected ────────────────────────────────────────────────────────────────────────────╮
│                                                                                                    │
│   We've changed the configuration of autodocs (previous docsPage), so now the value:               │
│     - docs.autodocs: true -- means automatically create docs for every CSF file                    │
│     - docs.autodocs: 'tag' -- means only create autodocs for CSF files with the 'autodocs' tag     │
│     - docs.autodocs: false -- means never create autodocs                                          │
│                                                                                                    │
│   Based on your prior configuration,  we can set the `docs.autodocs` to keep your old behaviour:   │
│                                                                                                    │
│   docs: { autodocs: true }                                                                         │
│                                                                                                    │
│   More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#autodocs-changes      │
│                                                                                                    │
╰────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'autodocsTrue' migration on your project? › (Y/n)✔ Do you want to run the 'autodocsTrue' migration on your project? … yes
✅ Setting 'docs.autodocs' to true in main.js
❌ The migration failed to update your null on your behalf because of the following error:
        TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string or an instance of Buffer or URL. Received null

⚠️ Storybook automigrations are based on AST parsing and it's possible that your null file contains a non-standard format (e.g. your export is not an object) or that there was an error when parsing dynamic values (e.g. "require" calls, or usage of environment variables). When your main config is non-standard, automigrations are unfortunately not possible. Please follow the instructions given previously and follow the documentation to make the updates manually.
✅ ran autodocsTrue migration

🔎 found a 'addReact' migration:
╭ Automigration detected ─────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                 │
│   We've detected that you're using @storybook/addon-essentials.                                                 │
│                                                                                                                 │
│   Starting in Storybook 7, we now require these peer dependencies to render docs:                               │
│                                                                                                                 │
│   - react                                                                                                       │
│   - react-dom                                                                                                   │
│                                                                                                                 │
│   We can add these for you automatically as dev dependencies.                                                   │
│                                                                                                                 │
│   More info: https://github.com/storybookjs/storybook/blob/next/MIGRATION.md#react-peer-dependencies-required   │
│                                                                                                                 │
╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
? Do you want to run the 'addReact' migration on your project? › (Y/n)✔ Do you want to run the 'addReact' migration on your project? … yes
✅ ran addReact migration

⚠️  failed to check fix wrap-require

TypeError [ERR_INVALID_ARG_TYPE]: The "path" argument must be of type string or an instance of Buffer or URL. Received null
    at __node_internal_captureLargerStackTrace (node:internal/errors:477:5)
    at new NodeError (node:internal/errors:387:5)
    at __node_internal_ (node:internal/fs/utils:673:11)
    at __node_internal_ (node:internal/fs/utils:685:3)
    at readFile (node:fs:402:10)
    at go$readFile (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/graceful-fs/graceful-fs.js:118:14)
    at Object.readFile (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/graceful-fs/graceful-fs.js:115:12)
    at /Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/universalify/index.js:8:12
    at new Promise (<anonymous>)
    at Object.readFile (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/universalify/index.js:7:14)
    at readConfig (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/csf-tools/dist/index.js:19:13791)
    at Object.check (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/cli/dist/generate.js:362:815)
    at async runFixes (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/cli/dist/generate.js:388:1239)
    at async automigrate (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/cli/dist/generate.js:385:676)
    at async doUpgrade (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/cli/dist/generate.js:417:3419)
    at async withTelemetry (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/core-server/dist/index.js:113:3910)
    at async upgrade (/Users/tung/.npm/_npx/bc7e1e37fcb46ffc/node_modules/@storybook/cli/dist/generate.js:417:3865)

╭ Migration check ran with failures ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│                                                                                                                                                               │
│   Successful migrations:                                                                                                                                      │
│                                                                                                                                                               │
│   new-frameworks, eslintPlugin, storybook-binary, sb-scripts, autodocsTrue, addReact                                                                          │
│                                                                                                                                                               │
│   Failed migrations:                                                                                                                                          │
│                                                                                                                                                               │
│   wrap-require:                                                                                                                                               │
│   The "path" argument must be of type string or an instance of Buffer or URL. Received null                                                                   │
│                                                                                                                                                               │
│   You can find the full logs in /Users/tung/workspace/woocommerce-blocks-webpack/migration-storybook.log                                                      │
│                                                                                                                                                               │
│   Manual migrations:                                                                                                                                          │
│                                                                                                                                                               │
│   incompatible-addons, removedglobalclientapis                                                                                                                │
│                                                                                                                                                               │
│   ─────────────────────────────────────────────────                                                                                                           │
│                                                                                                                                                               │
│   If you'd like to run the migrations again, you can do so by running 'npx storybook@next automigrate'                                                        │
│                                                                                                                                                               │
│   The automigrations try to migrate common patterns in your project, but might not contain everything needed to migrate to the latest version of Storybook.   │
│                                                                                                                                                               │
│   Please check the changelog and migration guide for manual migrations and more information: https://storybook.js.org/migration-guides/7.0                    │
│   And reach out on Discord if you need help: https://discord.gg/storybook                                                                                     │
│                                                                                                                                                               │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

